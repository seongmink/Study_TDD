# 실습 예제

## 자동판매기 잔돈 계산 모듈

음료 자판기에 탑재될 거스름돈 반환 모듈 개발 업무를 맡게 됐다.

> \- 최소 개수의 동전으로 잔돈을 돌려준다.
>
> 예) 1000원 넣고 650원짜리 음료를 선택했다면, 잔돈은 100, 100, 100, 50원으로 반환한다.
>
> \- 지폐를 잔돈으로 반환하는 경우는 없다고 가정한다.

비교적 간단한 예제로, 많은 사람이 TDD를 학습할 때 한 번 정도씩은 작성해보게 되는 예제다. 실제 프로젝트라면, 해당 요구사항을 좀 더 상세화하는 작업이 필요하겠지만, 여기서는 상식적인 수준으로 요구사항을 정련해서 개발을 마치기로 하자. 한 가지 조건을 덧붙이자면, 고객은 구현을 잘 모르기에 특정 구현 방식을 지정하고 있지 않다고 가정하기로 하자. 그저 반환되는 동전이 최소한이 되는 자판기 잔돈 계산 모듈을 구현해서 제공하면 충분하다.

### 개발 시작하기

만일 개발할 부분에 대한 이해가 명확하지가 않다면, 개발 시작하기 전에 간단한 사용자 시나리오를 작성해보는 것도 좋은 방법이다. 물론 많은 개발자의 경우, 우선 IDE 툴의 새 파일로 바로 시작해 타이핑에 바로 들어가는 경향이 있다. 하지만 그럴 경우 개발방향이 어디로 가게 될지 모르게 되기가 쉬우므로, 적어도 ToDo 리스트 정도는 가지고 시작하는 편이 좋다. 만일 현재 예제 상황이 실제 상업적인 업무 프로젝트이고 해당 개발영역이 본인이 잘 모르는 분야라면 고객 인터뷰라든가 관련 지식 학습이 함께 필요하겠지만, 다행히도 이번 경우는 우리가 흔히 접하고 쉽게 이해하고 있는 상황인 만큼 일반적인 경험을 토대로 사용자 관점에서의 시나리오를 한번 작성해보자.

> **업무 시나리오**
>
> 돈을 넣는다.
>
> → 투입한 금액이 표시된다.
>
> → 투입한 금액 내에서 선택 가능한 음료가 있다면 해당 버튼에 불이 들어온다.
>
> → 음료를 선택한다.
>
> → 음료가 나온다.
>
> → 투입금액 표시화면에는 선택한 음료 가격만큼 제외된 가격이 표시된다.
>
> → 만일 표시된 남은 금액이 다른 음료를 선택할 수 있는 금액 이하이면 바로 잔돈으로 반환한다.
>
> → 다른 음료를 선택할 수 있는 금액이 남아 있다면 최초 동전을 넣었을 때와 동일하게 동작한다.
>
> → 반환 버튼을 눌렀을 경우 상황에 관계없이 표시되어 있는 금액을 최소 잔돈으로 반환한다.

현재 상황은 사람과 기계의 고독한 대화 상황이라고 볼 수 있다. 이 정도 시나리오를 만들고 개발에 들어가려고 보면, 우리는 사람의 행동을 구현할 수는 없으니까 그 부분은 찾아서 제외시켜 보자.

> **업무 시나리오**
>
> ~~돈을 넣는다.~~ (사람)
>
> → 투입한 금액이 표시된다.
>
> → 투입한 금액 내에서 선택 가능한 음료가 있다면 해당 버튼에 불이 들어온다.
>
> → ~~음료를 선택한다.~~ (사람)
>
> → 음료가 나온다.
>
> → 투입금액 표시화면에는 선택한 음료 가격만큼 제외된 가격이 표시된다.
>
> → 만일 표시된 남은 금액이 다른 음료를 선택할 수 있는 금액 이하이면 바로 잔돈으로 반환한다.
>
> → 다른 음료를 선택할 수 있는 금액이 남아 있다면 최초 동전을 넣었을 때와 동일하게 동작한다.
>
> → ~~반환 버튼을 눌렀을 경우~~ 상황에 관계없이 표시되어 있는 금액을 최소 잔돈으로 반환한다. (일부 사람)

이제 사람의 행동은 제외하고, 자판기의 동작만 남았다. '자, 그럼 이제 구현에 들어가야겠다'라고 생각하고 작업하려고 보면, 어떻게 할 수 없는 부분이 있다는 걸 알게 된다. 즉, 남은 시나리오에는 하드웨어적인 액션과 소프트웨어적인 액션이 혼재되어 있는데, 하드웨어는 업무범위를 벗어나니까 제외해보자.

> **업무 시나리오**
>
> ~~돈을 넣는다.~~ (사람)
>
> → 투입한 금액이 표시된다.
>
> → ~~투입한 금액 내에서 선택 가능한 음료가 있다면 해당 버튼에 불이 들어온다.~~(하드웨어)
>
> → ~~음료를 선택한다.~~ (사람)
>
> → ~~음료가 나온다.~~(하드웨어)
>
> → 투입금액 표시화면에는 선택한 음료 가격만큼 제외된 가격이 표시된다.
>
> → 만일 표시된 남은 금액이 다른 음료를 선택할 수 있는 금액 이하이면 바로 잔돈으로 반환한다.
>
> → 다른 음료를 선택할 수 있는 금액이 남아 있다면 최초 동전을 넣었을 때와 동일하게 동작한다.
>
> → ~~반환 버튼을 눌렀을 경우~~ 상황에 관계없이 표시되어 있는 금액을 최소 잔돈으로 반환한다. (일부 사람)

이번엔 개발범위를 한정할 수 있도록 업무 시나리오를 다시 정련해보자.

> **개발 가능 범위**
>
> \- 투입한 금액이 표시된다. → 투입한 금액을 알 수 있다. 즉, 현재 잔액을 알 수 있다.
>
> \- 투입금액 표시화면에는 선택한 음료 가격만큼 제외된 가격이 표시된다. → 현재 잔액을 알 수 있다. 
>
> \- 만일 표시된 남은 금액이 다른 음료를 선택할 수 있는 금액 이하이면 바로 잔돈으로 반환한다. → 잔액이 최소음료가격 이하인지 여부를 확인한다.
>
> \- 다른 음료를 선택할 수 있는 금액이 남아 있다면 최초 동전을 넣었을 때와 동일하게 동작한다. (소프트웨어) 
>
> \- 표시되어 있는 금액을 최소 잔돈으로 반환한다.

가능 범위를 적고 보면 크게 몇 가지 기능으로 축약된다.

> \- 음료수의 가격 확인
>
> \- 잔액 확인
>
> \- 잔돈 반환

한참을 돌아왔는데, 이 중에서 우리가 구현할 부분은 잔돈 반환 부분이다. 아니, 처음부터 잔돈 반환인데, 왜 이렇게 돌아온 거냐고 의아해할 수도 있다. 하지만 이런 식으로 미리 파악해놓으면, 우리가 구현해야 하는 부분은 전체 중에서 어디쯤에 속해 있는지, 다른 부분과 어떤 식으로 연계가 되는지를 알 수 있으며, 결과적으로 더 올바른 방식으 로 구현할 수 있게 도와준다. 많은 경우에 있어, 고객의 말에만 의존하지 말고 고객의 업무도 함께 확인해야 한다.

그리고 이런 식으로 접근하면 얻게 되는 이점이 하나 있는데, 바로 이번 예제의 핵심 부분을 발견하게 된다. 즉, 잔액 확인 기능이 필요한 부분이다. 처음 요구사항만 보고 개발에 들어가는 많은 개발자는 다음과 같은 식으로 논리를 전개해가는 경우가 많다.

> 동전을 투입한다. → 음료를 화면에 출력한다. → 음료를 선택한다. → 남은 돈을 반환한다.

이런 식으로 지나치게 단순화되거나, 행위의 주체 구분이 모호하게 섞이고 생략되면 어떤 부분에서 어떻게 개발을 시작해야 할지 헷갈리며, 문제가 복잡해진다. 그리고 흔히 빠지는 함정 중 하나는, 동전을 정의하는 부분과 화면 출력 부분을 자신도 모르는 사이에 깊게 고민하게 되고, 구현범위에 넣어버리게 된다는 점이다. 결국엔 개발시간 부족에 시달리게 된다.

자, 어쨌든 이제 구현범위는 간단 명확해졌다. '잔액 확인', '잔액만큼 최소 동전으로 거스름돈 반환', 두 개다.

테스트 케이스를 작성해보자.